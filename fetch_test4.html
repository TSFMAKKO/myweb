<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .newImg {
        width: 500px;
        height: 500px;
        overflow: hidden;
    }

    .newImg img {
        width: 100%;
    }
</style>

<body>
    <h2>Hello Fetch</h2>
    <div class="newImg"></div>
    <div class="newTxt"></div>
    <div class="newJson"></div>
    <div class="newJson2"></div>
    <div class="axios"></div>

    <div class="newJson3"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
        integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
        crossorigin="anonymous"></script>
    <script>
        // unsplash 上的圖片
        let url = 'https://images.unsplash.com/photo-1513313778780-9ae4807465f0?auto=format&fit=crop&w=634&q=80'
        fetch(url)
            .then((response) => {
                return response.blob();
            })
            .then((imageBlob) => {
                let img = document.createElement('IMG')
                document.querySelector('.newImg').appendChild(img);
                // 將 blog 物件轉為 url
                console.log(imageBlob);
                img.src = URL.createObjectURL(imageBlob);
            })

        // https://tsfmakko.github.io/myweb/fetch_txt_test.text
        // let url2 = './fetch_txt_test.text'
        // fetch(url2)
        //     .then((response) => {
        //         return response.text();
        //     })
        //     .then((txt) => {
        //         console.log(txt);
        //         let p = document.createElement('p')
        //         p.innerHTML = txt;
        //         // 將 blog 物件轉為 url
        //         // img.src = URL.createObjectURL(txt);
        //         document.querySelector('.newTxt').appendChild(p);
        //     })

        // https://tsfmakko.github.io/myweb/fetch_json.json
        // let url3 = 'https://tsfmakko.github.io/myweb/fetch_json.json';
        let url3 = 'https://data.taipei/api/v1/dataset/cb0a6b48-9d85-4e7a-8134-a14552de7574?scope=resourceAquire';
        fetch(url3)
            .then((response) => {
                return response.json();
            })
            .then((res) => {
                console.log(res);
                console.log(res.result.results[0]);
                let p = document.createElement('p');
                // p.innerHTML = res.result.results[0]['109年件數'];
                // p.innerHTML = Object.keys(res.result.results[0]);
                p.innerHTML = JSON.stringify(res.result.results[0]);
                // 將 blog 物件轉為 url
                // img.src = URL.createObjectURL(txt);
                document.querySelector('.newJson').appendChild(p);
            })

        // let url4 = './fetch_json.json';
        // fetch(url4)
        //     .then((response) => {
        //         return response.json();
        //     })
        //     .then((txt) => {
        //         console.log(txt);
        //         let p = document.createElement('p')
        //         p.innerHTML = txt;
        //         // 將 blog 物件轉為 url
        //         // img.src = URL.createObjectURL(txt);
        //         document.querySelector('.newJson2').appendChild(p);
        //     })

        let XHR = null;

        function startRequest() {
            console.log('startRequest');
            // XHR = createXMLHttpRequest();
            XHR = new XMLHttpRequest();
            XHR.open('GET', './fetch_json.json');
            // XHR.open('GET', 'https://data.taipei/api/v1/dataset/cb0a6b48-9d85-4e7a-8134-a14552de7574?scope=resourceAquire');
            // XHR.open('GET', 'https://tsfmakko.github.io/myweb/fetch_json.json');
            XHR.onreadystatechange = handleStateChange;
            XHR.send(null);
        }


        function handleStateChange() {
            console.log('handleStateChange');
            if (XHR.readyState == 4) {
                if (XHR.status == 200) {
                    document.querySelector('.newJson3').innerHTML = XHR.responseText;
                }
            }
        }

        startRequest();

        axios
            .get('https://www.runoob.com/try/ajax/json_demo.json')
            .then(response => (this.info = response.data.sites))
    </script>
</body>

</html>